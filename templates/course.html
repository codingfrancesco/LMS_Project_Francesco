{% extends 'base.html' %}

{% block title %}Browse Courses{% endblock %}

{% block content %}
    {% if is_student and enrolled_courses %}
        <h1>ğŸ“š Your Enrolled Courses</h1>
        <p>Continue your learning journey with the courses you're already taking.</p>
        
        <div style="margin: 20px 0; display: flex; gap: 10px;">
            <button id="enrolledTab" class="btn btn-primary" style="cursor: pointer;">âœ“ Enrolled Courses ({{ enrolled_courses | length }})</button>
            <button id="allTab" class="btn btn-secondary" style="cursor: pointer;">ğŸ“– All Courses</button>
        </div>
        
        <div id="enrolledSection">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                {% for course in enrolled_courses %}
                    <div class="card" style="display: flex; flex-direction: column; border-left: 5px solid var(--accent-blue);">
                        <div style="background: linear-gradient(135deg, var(--primary-navy), var(--primary-blue)); padding: 20px; color: white; border-radius: 8px 8px 0 0;">
                            <h3 style="margin: 0; font-size: 20px;">{{ course.title }}</h3>
                            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">ğŸ‘¨â€ğŸ« {{ course.teacher_name or 'Instructor' }}</p>
                        </div>
                        
                        <div class="card-body" style="flex: 1; display: flex; flex-direction: column;">
                            <p style="color: var(--medium-text); line-height: 1.6;">{{ course.description or 'No description available.' }}</p>
                            
                            <div style="margin: 15px 0; padding: 15px; background: var(--bg-light); border-radius: 6px;">
                                <small style="color: var(--medium-text);">ğŸ“Š Progress: {{ course.progress or 0 }}%</small>
                                <div style="background: #ddd; border-radius: 4px; height: 8px; margin-top: 8px; overflow: hidden;">
                                    <div style="background: var(--accent-blue); height: 100%; transition: width 0.3s; --progress: {{ course.progress or 0 }}%; width: calc(var(--progress));"></div>
                                </div>
                            </div>
                            
                            <p class="text-muted"><small>Enrolled: {{ course.enrolled_at or 'Recently' }}</small></p>
                            
                            <div style="display: flex; gap: 10px; margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <a href="{{ url_for('manage_course', course_id=course.id) }}" class="btn btn-primary" style="flex: 1; text-align: center;">
                                    ğŸ“š Continue Learning
                                </a>
                                <a href="{{ url_for('course') }}#allTab" class="btn btn-secondary" style="flex: 1; text-align: center;">
                                    ğŸ“– More Courses
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        
        <div id="allSection" style="display: none;">
            <h2 style="margin-top: 30px;">ğŸ“– All Available Courses</h2>
            <p>Expand your skills by enrolling in additional courses.</p>
            
            <div style="margin: 20px 0;">
                <input type="text" class="searchInput" placeholder="ğŸ” Search courses..." style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 16px;">
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                {% for course in all_courses %}
                    <div class="card course-card" style="display: flex; flex-direction: column;">
                        <div style="background: linear-gradient(135deg, var(--primary-navy), var(--primary-blue)); padding: 20px; color: white; border-radius: 8px 8px 0 0;">
                            <h3 style="margin: 0; font-size: 20px;">{{ course.title }}</h3>
                            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">ğŸ‘¨â€ğŸ« {{ course.teacher_name or 'Instructor' }}</p>
                        </div>
                        
                        <div class="card-body" style="flex: 1; display: flex; flex-direction: column;">
                            <p style="color: var(--medium-text); line-height: 1.6;">{{ course.description or 'No description available.' }}</p>
                            
                            <div style="margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <div style="display: flex; gap: 10px;">
                                    <a href="{{ url_for('enroll_course', course_id=course.id) }}" class="btn btn-primary" style="flex: 1; text-align: center;">
                                        â• Enroll Now
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <h1>ğŸ“š Browse All Courses</h1>
        <p>Explore our comprehensive collection of courses and expand your knowledge.</p>
        
        {% if error %}
            <div style="background: #fee; border: 1px solid #f88; color: #c33; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px;">
                âš ï¸ {{ error }}
            </div>
        {% endif %}
        
        <div style="margin: 20px 0;">
            <input type="text" id="searchInput" placeholder="ğŸ” Search courses..." style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 16px;">
        </div>
        
        {% if all_courses %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                {% for course in all_courses %}
                    <div class="card course-card" style="display: flex; flex-direction: column;">
                        <div style="background: linear-gradient(135deg, var(--primary-navy), var(--primary-blue)); padding: 20px; color: white; border-radius: 8px 8px 0 0;">
                            <h3 style="margin: 0; font-size: 20px;">{{ course.title }}</h3>
                            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">ğŸ‘¨â€ğŸ« {{ course.teacher_name or 'Instructor' }}</p>
                        </div>
                        
                        <div class="card-body" style="flex: 1; display: flex; flex-direction: column;">
                            <p style="color: var(--medium-text); line-height: 1.6;">{{ course.description or 'No description available for this course.' }}</p>
                            
                            <div style="margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <div style="display: flex; gap: 10px;">
                                    {% if is_logged_in and is_student %}
                                        <a href="{{ url_for('enroll_course', course_id=course.id) }}" class="btn btn-primary" style="flex: 1; text-align: center;">
                                            â• Enroll Now
                                        </a>
                                    {% else %}
                                        <a href="{{ url_for('login') }}" class="btn btn-primary" style="flex: 1; text-align: center;">
                                            ğŸ” Login to Enroll
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 40px; text-align: center; color: var(--light-text);">
                <p>Showing {{ all_courses | length }} course(s)</p>
            </div>
        {% else %}
            <div style="background: #e8f0f8; border: 2px solid var(--accent-blue); padding: 40px; border-radius: 12px; text-align: center; margin-top: 40px;">
                <h2 style="color: var(--primary-navy); margin-bottom: 15px;">ğŸ“­ No Courses Available</h2>
                <p style="color: var(--medium-text); font-size: 16px; margin-bottom: 20px;">
                    Check back soon! New courses are being added regularly.
                </p>
                <a href="{{ url_for('home') }}" class="btn btn-primary">ğŸ  Return to Home</a>
            </div>
        {% endif %}
    {% endif %}
    
    <script>
        // Tab switching for enrolled students
        const enrolledTab = document.getElementById('enrolledTab');
        const allTab = document.getElementById('allTab');
        const enrolledSection = document.getElementById('enrolledSection');
        const allSection = document.getElementById('allSection');
        
        if (enrolledTab && allTab) {
            enrolledTab.addEventListener('click', function() {
                enrolledSection.style.display = '';
                allSection.style.display = 'none';
                enrolledTab.classList.remove('btn-secondary');
                enrolledTab.classList.add('btn-primary');
                allTab.classList.remove('btn-primary');
                allTab.classList.add('btn-secondary');
            });
            
            allTab.addEventListener('click', function() {
                enrolledSection.style.display = 'none';
                allSection.style.display = '';
                allTab.classList.remove('btn-secondary');
                allTab.classList.add('btn-primary');
                enrolledTab.classList.remove('btn-primary');
                enrolledTab.classList.add('btn-secondary');
            });
        }
        
        // Search filter functionality
        const searchInputs = document.querySelectorAll('#searchInput, .searchInput');
        searchInputs.forEach(searchInput => {
            searchInput.addEventListener('keyup', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const cards = this.parentElement.nextElementSibling.querySelectorAll('.course-card');
                
                cards.forEach(card => {
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    const description = card.querySelector('.card-body p').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || description.includes(searchTerm)) {
                        card.parentElement.style.display = '';
                    } else {
                        card.parentElement.style.display = 'none';
                    }
                });
            });
        });
    </script>
{% endblock %}
